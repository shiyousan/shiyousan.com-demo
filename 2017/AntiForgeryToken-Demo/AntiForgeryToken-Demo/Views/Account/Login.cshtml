
@{
    ViewBag.Title = "Login";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-md-4 col-md-offset-3">
        <h2 class="text-primary">登录页面</h2>
        @using (Html.BeginForm("Login", "Account",FormMethod.Post,new { id = "formLogin" }))
        {            
            <div id="divAntiForgeryToken">@Html.AntiForgeryToken()</div>
            <input type="hidden" name="ReturnUrl" value="@ViewBag.ReturnUrl" />
            <div class="form-group">
                <label for="login-name">账号：</label>
                <input type="text" class="form-control login-field" value="test" placeholder="输入账号" id="login-name" name="UserName" />
            </div>
            <div class="form-group">
                <input type="submit" value="登陆" class="btn btn-primary btn-lg btn-block" />
                <a href="/Home/Index">返回首页</a>
            </div>
        }
    </div>

</div>
@section scripts{
    <script type="text/javascript">
        //$(function () {
        //    $("#formLogin").submit(function () {
        //        $.get('/Account/RefreshToken', function (data) {
        //            alert(data);
        //            $("#divAntiForgeryToken").empty().append(data);
        //        });
                
        //    });
        //});
        $(function () {
            //需要使用jQuery库
            $('#formLogin').submit(function () {
                //一定不能使用异步！
                $.ajax({
                    url: '/Account/RefreshToken', async: false, type: 'GET', success: function (data) {                        
                        //var tokenValue = $('<div />').html(data).find('input[type="hidden"]').val();
                        //$('input[name="__RequestVerificationToken"]').val(tokenValue);                        
                        $("#divAntiForgeryToken").empty().append(data);
                    }
                });
                //return false;
            });
        });
    </script>
    }
